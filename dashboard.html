<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="./assets/css/dashboard.css">
    <script src="https://kit.fontawesome.com/6ced12f15b.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <h2><abbr title="Create | Read | Update | Delete">CRUD</abbr> de Funcion치rios</h2>
    </header>

    <div id="wrapper">
        <button id="btn">
            <i class="fas fa-user-plus"></i>
            <a href="http://127.0.0.1:5500/registro.html">Criar usu치rio</a>
        </button>
        <input class="search" type="search" id="idUser" name="idUser" value="">
        <button id="btn-pesq" type="button" class="btn btn-primary" onClick="listByID();"><i class="fas fa-search"></i></button>
    </div>   
    <div class="list">
        <ul>
        </ul>
    </div>
</body>
    <script>
        var myList = document.querySelector('ul');
        listByID(``); //No refresh
        function listaUsuario(loginuser) {
          for (var i = 0; i < loginuser.length; i++) {
            var listItem = document.createElement('li');
            listItem.innerHTML += `<input type="text" class="id" id="idUser-${loginuser[i].idUser}" value="${loginuser[i].idUser}">`;
            listItem.innerHTML += `<input type="text" class="nome" id="nome-${loginuser[i].idUser}" value="${loginuser[i].nome}">`;
            listItem.innerHTML += `<input type="text"  id="emailUser-${loginuser[i].idUser}" value="${loginuser[i].emailUser}">`;
            listItem.innerHTML += `<input type="text"  id="cargo-${loginuser[i].idUser}" value="${loginuser[i].cargo}">`;
            listItem.innerHTML += `<input type="text"  id="salario-${loginuser[i].idUser}" value="${loginuser[i].salario}">`;
            listItem.innerHTML += `<input type="text"  id="setor-${loginuser[i].idUser}" value="${loginuser[i].setor}">`;
            listItem.innerHTML += `<input type="password" id="senhaUser-${loginuser[i].idUser}" value="${loginuser[i].senhaUser}">`;
            listItem.innerHTML += `<button onclick="deleta(${loginuser[i].idUser});">Apagar</button>`;
            listItem.innerHTML += `<button onclick="atualizar(${loginuser[i].idUser});">Atualizar</button>`;
            listItem.innerHTML += `<img src="${loginuser[i].imagem_user}">`;
            myList.appendChild(listItem);
          }
        }
        function listByID(idUser) {
          myList.innerHTML = ""
          idUser = document.getElementById(`idUser`).value
          fetch('http://localhost:8080/loginuser/' + idUser)
            .then(function (response) {
              console.log(response.json)
              if (!response.ok) { throw new Error("HTTP error, status = " + response.status); }
              return response.json();
            })
            .then((loginuser) => listaUsuario(loginuser))
        }

        function deleta(idUser) {
            fetch('http://localhost:8080/loginuser/' + idUser, {
            method: 'DELETE'
            });
            alert("Usu치rio Excluido com sucesso!")
            window.location.reload();
        }

        function atualizar(idUser) {
            const nome = document.getElementById(`nome-${idUser}`).value;
            const emailUser = document.getElementById(`emailUser-${idUser}`).value;
            const cargo = document.getElementById(`cargo-${idUser}`).value;
            const salario = document.getElementById(`salario-${idUser}`).value;
            const setor = document.getElementById(`setor-${idUser}`).value;
            const senhaUser = document.getElementById(`senhaUser-${idUser}`).value;
            fetch('http://localhost:8080/loginuser/' + idUser, {
                method: 'PATCH',
                body: `{"nome": "${nome}", "emailUser": "${emailUser}", "cargo": "${cargo}", "salario": "${salario}", "setor": "${setor}", "senhaUser": "${senhaUser}"}`,
                headers: { 'Content-Type': 'application/json' },
            });
            alert("Usu치rio Atualizado com sucesso!");
            window.location.reload();
        }
    </script>
</html>